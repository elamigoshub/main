<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Descarga — ElAmigosHUB</title>

  <style>
    :root{
      --bg:#0b1220; --card:#101a30; --muted:#8ea0c7; --text:#eaf0ff;
      --line:rgba(255,255,255,.10); --btn:#2f6bff; --max:900px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;background:var(--bg);color:var(--text);}
    header{border-bottom:1px solid var(--line);padding:16px;}
    main{max-width:var(--max);margin:auto;padding:18px 16px 42px;}
    .card{border:1px solid var(--line);background:rgba(16,26,48,.75);border-radius:16px;overflow:hidden;}
    .cover{width:100%;height:220px;object-fit:cover;display:block;}
    .b{padding:14px;}
    .muted{color:var(--muted);line-height:1.6}
    .row{display:flex;gap:12px;flex-wrap:wrap;margin-top:14px;}
    .btn{
      display:inline-flex;align-items:center;justify-content:center;
      padding:12px 14px;border-radius:12px;border:1px solid var(--line);
      background:var(--btn);font-weight:800; text-decoration:none;
    }
    .btn.alt{background:transparent;}
    .btn.disabled{
      background:rgba(255,255,255,.06);
      color:var(--muted);
      cursor:not-allowed;
      pointer-events:none;
    }
    .notice{margin-top:12px;color:var(--muted);font-size:13px}
  </style>
</head>
<body>

<header>
  <strong><a href="./index.html" style="color:inherit;text-decoration:none">ElAmigosHUB</a></strong>
</header>

<main>
  <div id="box" class="card"></div>
</main>

<!-- Adsterra (para monetizar esta intermedia) -->
<script src="https://pl28424505.effectivegatecpm.com/3a/ae/93/3aae93d0b1b617ac83e45f1eb9745735.js"></script>
<script src="https://pl28425159.effectivegatecpm.com/57/5c/a5/575ca5ca6fa90ae43377ac49a45da19f.js"></script>

<script>
  const SMARTLINK = "https://www.effectivegatecpm.com/vrz4ii26?key=a8db24c7cfd144939d6c3b694e6f4a98";
  const slug = new URLSearchParams(location.search).get("slug") || "";

  function esc(s){
    return (s||"").toString()
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  function isRealLink(url){
    if(!url) return false;
    const u = url.trim();
    return u !== "#" && u !== "";
  }

  async function loadGames(){
    // ✅ RELATIVA
    const r = await fetch("data/games.json", { cache:"no-store" });
    if(!r.ok) throw new Error("No se pudo cargar data/games.json (HTTP " + r.status + ")");
    const data = await r.json();
    return Array.isArray(data) ? data : (data.games || []);
  }

  window.addEventListener("DOMContentLoaded", async () => {
    const box = document.getElementById("box");

    try{
      const games = await loadGames();
      const g = games.find(x => (x.slug||"") === slug);

      if(!g){
        box.innerHTML = `<div class="b">
          <p class="muted">Juego no encontrado.</p>
          <div class="row"><a class="btn alt" href="./index.html">Volver</a></div>
        </div>`;
        return;
      }

      const title = esc(g.title||"");
      const cover = esc(g.cover||"");
      const desc = esc(g.description||"");

      const free = (g.download_free || "").trim();
      const premium = (g.download_premium && g.download_premium !== "#") ? g.download_premium : SMARTLINK;

      const freeAvailable = isRealLink(free);

      box.innerHTML = `
        <img class="cover" src="${cover}" alt="${title}">
        <div class="b">
          <h2 style="margin:0 0 8px;">${title}</h2>
          <p class="muted" style="margin:0;">${desc}</p>

          <div class="notice">
            Estás en la página intermedia de descarga.
            ${freeAvailable ? "Pulsa continuar para ir al servidor." : "Este juego aún no tiene enlace de descarga normal."}
          </div>

          <div class="row">
            ${
              freeAvailable
                ? `<a class="btn" href="${free}" target="_blank" rel="nofollow noopener">Continuar a 1fichier</a>`
                : `<span class="btn disabled">Descarga normal no disponible</span>`
            }
            <a class="btn alt" href="${premium}" target="_blank" rel="nofollow noopener">Premium</a>
            <a class="btn alt" href="./index.html">Volver</a>
          </div>
        </div>
      `;
    }catch(e){
      console.error(e);
      box.innerHTML = `<div class="b">
        <p class="muted"><strong style="color:#eaf0ff">Error cargando datos.</strong><br>${esc(e.message)}</p>
        <div class="row"><a class="btn alt" href="./index.html">Volver</a></div>
      </div>`;
    }
  });
</script>

</body>
</html>
