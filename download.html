<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Descarga — ElAmigosHUB</title>

  <style>
    :root{
      --bg:#0b1220; --card:#101a30; --muted:#8ea0c7; --text:#eaf0ff;
      --line:rgba(255,255,255,.10); --btn:#2f6bff; --max:900px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;
      background:var(--bg);
      color:var(--text);
    }
    header{border-bottom:1px solid var(--line);padding:16px;}
    main{max-width:var(--max);margin:auto;padding:18px 16px 42px;}
    .card{border:1px solid var(--line);background:rgba(16,26,48,.75);border-radius:16px;overflow:hidden;}
    .cover{width:100%;height:220px;object-fit:cover;display:block;}
    .b{padding:14px;}
    .muted{color:var(--muted);line-height:1.6}
    .row{display:flex;gap:12px;flex-wrap:wrap;margin-top:14px;}

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:12px 14px;
      border-radius:12px;
      border:1px solid var(--line);
      background:var(--btn);
      font-weight:800;
      text-decoration:none;
      min-width:220px;
    }
    .btn.alt{background:transparent;min-width:auto;}
    .btn.disabled{
      background:rgba(255,255,255,.06);
      color:var(--muted);
      cursor:not-allowed;
      pointer-events:none;
    }

    .notice{margin-top:12px;color:var(--muted);font-size:13px}

    .countdown{
      margin-top:12px;
      padding:10px 12px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
      border-radius:12px;
      color:var(--muted);
      font-size:13px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      flex-wrap:wrap;
    }
    .countdown strong{color:var(--text)}
  </style>
</head>
<body>

<header>
  <strong><a href="./index.html" style="color:inherit;text-decoration:none">ElAmigosHUB</a></strong>
</header>

<main>
  <div id="box" class="card"></div>
</main>

<!-- ========================= -->
<!-- Adsterra: Popunder + Social Bar -->
<!-- ========================= -->
<script src="https://pl28424505.effectivegatecpm.com/3a/ae/93/3aae93d0b1b617ac83e45f1eb9745735.js"></script>
<script src="https://pl28425159.effectivegatecpm.com/57/5c/a5/575ca5ca6fa90ae43377ac49a45da19f.js"></script>

<script>
  const SMARTLINK = "https://www.effectivegatecpm.com/vrz4ii26?key=a8db24c7cfd144939d6c3b694e6f4a98";
  const DELAY_SECONDS = 5;
  const slug = new URLSearchParams(location.search).get("slug") || "";

  function esc(s){
    return (s||"").toString()
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }
  function isRealLink(url){
    if(!url) return false;
    const u = String(url).trim();
    return u !== "" && u !== "#";
  }

  async function loadGames(){
    const r = await fetch("data/games.json", { cache:"no-store" });
    if(!r.ok) throw new Error("No se pudo cargar data/games.json (HTTP " + r.status + ")");
    const data = await r.json();
    return Array.isArray(data) ? data : (data.games || []);
  }

  function startCountdown(btn, counter, targetUrl){
    let t = DELAY_SECONDS;
    btn.classList.add("disabled");
    btn.removeAttribute("href");
    counter.innerHTML = `Esperando… <strong>${t}s</strong>`;

    const timer = setInterval(() => {
      t--;
      if (t <= 0){
        clearInterval(timer);
        counter.innerHTML = `Listo ✅ <strong>puedes continuar</strong>`;
        btn.classList.remove("disabled");
        btn.setAttribute("href", targetUrl);
        btn.textContent = "Continuar a 1fichier";
      } else {
        counter.innerHTML = `Esperando… <strong>${t}s</strong>`;
      }
    }, 1000);
  }

  window.addEventListener("DOMContentLoaded", async () => {
    const box = document.getElementById("box");

    try{
      const games = await loadGames();
      const g = games.find(x => (x.slug||"") === slug);

      if(!g){
        box.innerHTML = `<div class="b">
          <p class="muted">Juego no encontrado.</p>
          <div class="row"><a class="btn alt" href="./index.html">Volver</a></div>
        </div>`;
        return;
      }

      const free = (g.download_free || "").trim();
      const premium = isRealLink(g.download_premium) ? g.download_premium : SMARTLINK;
      const freeAvailable = isRealLink(free);

      box.innerHTML = `
        <img class="cover" src="${esc(g.cover)}" alt="${esc(g.title)}">
        <div class="b">
          <h2 style="margin:0 0 8px;">${esc(g.title)}</h2>
          <p class="muted" style="margin:0;">${esc(g.description||"")}</p>

          <div class="notice">
            ${freeAvailable
              ? "Espera unos segundos y se activará el enlace de descarga."
              : "Este juego aún no tiene enlace de descarga normal."
            }
          </div>

          <!-- Banner GIF visible -->
          <div style="max-width:720px;margin:14px auto 0;">
            <a href="${SMARTLINK}" target="_blank" rel="nofollow noopener">
              <img
                src="https://landings-cdn.adsterratech.com/referralBanners/gif/720x90_adsterra_reff.gif"
                alt="Publicidad"
                style="width:100%;height:auto;border-radius:12px;display:block;border:1px solid rgba(255,255,255,.10)"
                loading="lazy"
              />
            </a>
          </div>

          ${freeAvailable ? `
            <div class="countdown">
              <span>Activando el enlace…</span>
              <span id="counter"><strong>${DELAY_SECONDS}s</strong></span>
            </div>
          ` : ""}

          <div class="row">
            ${
              freeAvailable
                ? `<a id="freeBtn" class="btn" href="${free}" target="_blank" rel="nofollow noopener">Continuar a 1fichier</a>`
                : `<span class="btn disabled">Descarga normal no disponible</span>`
            }
            <a class="btn alt" href="${premium}" target="_blank" rel="nofollow noopener">Premium</a>
            <a class="btn alt" href="./index.html">Volver</a>
          </div>
        </div>
      `;

      if (freeAvailable){
        startCountdown(
          document.getElementById("freeBtn"),
          document.getElementById("counter"),
          free
        );
      }

    }catch(e){
      box.innerHTML = `<div class="b">
        <p class="muted"><strong>Error:</strong> ${esc(e.message)}</p>
        <div class="row"><a class="btn alt" href="./index.html">Volver</a></div>
      </div>`;
      console.error(e);
    }
  });
</script>

</body>
</html>
